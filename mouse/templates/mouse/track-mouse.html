<!DOCTYPE html>
<html>
<head>
    <title>Mouse Tracking</title>
</head>
<body>

<!-- <script>
let mouseData = []; // 마우스 및 키보드 데이터를 저장할 배열
const sendDataInterval = 5000; // 데이터를 전송할 시간 간격 (예: 5000ms = 5초)

// 마우스 이동 이벤트 처리
document.addEventListener('mousemove', (event) => {
    mouseData.push({
        type: 'move',
        x: event.pageX,
        y: event.pageY,
        timestamp: new Date().toISOString()
    });
});

// 마우스 클릭 이벤트 처리
document.addEventListener('click', (event) => {
    mouseData.push({
        type: 'click',
        x: event.pageX,
        y: event.pageY,
        timestamp: new Date().toISOString()
    });
});

// 키보드 이벤트 처리
document.addEventListener('keydown', (event) => {
    // 브라우저에서 기본적으로 사용하는 키 조합(예: F5, Ctrl+R 등)은 제외하고자 할 때 조건문 추가 가능
    mouseData.push({
        type: 'keydown',
        key: event.key, // 눌린 키의 값을 저장
        timestamp: new Date().toISOString()
    });
});

// 설정된 시간 간격마다 서버로 데이터 전송
setInterval(() => {
    if (mouseData.length > 0) {
        sendDataToServer(mouseData);
        mouseData = []; // 데이터 전송 후 배열 초기화
    }
}, sendDataInterval);

// 서버로 데이터 전송하는 함수
function sendDataToServer(data) {
    fetch('/mouse/track-data/', { // 경로를 일반화하여 모든 이벤트를 처리할 수 있는 URL로 변경
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => console.log('Success:', data))
    .catch((error) => console.error('Error:', error));
}

// CSRF 토큰을 가져오는 함수
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script> -->

<script>
let mouseData = [];
const sendDataInterval = 5000; // 데이터를 전송할 시간 간격 (예: 5000ms = 5초)

document.addEventListener('mousemove', (event) => {
    mouseData.push({
        type: 'move',
        x: event.pageX,
        y: event.pageY,
        timestamp: new Date().toISOString()
    });
});

document.addEventListener('click', (event) => {
    mouseData.push({
        type: 'click',
        x: event.pageX,
        y: event.pageY,
        timestamp: new Date().toISOString()
    });
});

setInterval(() => {
    if (mouseData.length > 0) {
        sendDataToServer(mouseData);
        mouseData = []; // 데이터 전송 후 배열 초기화
    }
}, sendDataInterval);

function sendDataToServer(data) {
    fetch('/mouse/track-mouse/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(data => console.log('Success:', data))
    .catch((error) => console.error('Error:', error));
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script>


<!-- <script>
document.addEventListener('DOMContentLoaded', function() {
    document.addEventListener('click', function(event) {
        const clickData = {
            x: event.pageX,
            y: event.pageY,
            timestamp: Date.now()
        };
        console.log('Mouse Click:', clickData);
        sendDataToServer(clickData, 'click');
    });

    document.addEventListener('mousemove', function(event) {
        const moveData = {
            x: event.pageX,
            y: event.pageY,
            timestamp: Date.now()
        };
        // 여기서는 성능을 위해 마우스 이동 데이터를 바로 전송하지 않고, 필요에 따라 샘플링하거나 일정 시간 간격으로 데이터를 묶어 전송하는 것을 고려해야 합니다.
    });
});

function sendDataToServer(data, eventType) {
    fetch('/track-mouse/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken') // CSRF 토큰을 포함시킵니다.
        },
        body: JSON.stringify({data: data, type: eventType})
    })
    .then(response => response.json())
    .then(data => console.log('Success:', data))
    .catch((error) => console.error('Error:', error));
}

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}
</script> -->

</body>
</html>
